!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var r,o;r=[n(1),n(5),n(13),n(14),n(9),n(10),n(15),n(16)],o=function(e,t,n,r,o,i,a,s){window.sampleUI=window.sampleUI||{};var c=window.sampleUI;c.commonUI=e,c.dialog=t,c.dpad=n,c.input=r,c.misc=o,c.mobileHacks=i,c.strings=a,c.touch=s}.apply(t,r),!(void 0!==o&&(e.exports=o))},function(e,t,n){var r,o;"use strict",r=[n(3),n(8),n(4),n(5),n(6),n(2),n(9),n(10),n(11),n(12)],o=function(e,t,n,r,o,i,a,s,c,u){function l(e){if(e=e||"",!v){v=document.createElement("div");var t=document.getElementById("hft-menu");t.parentNode.insertBefore(v,t)}e.indexOf("portrait")>=0?v.innerHTML=E:e.indexOf("landscape")>=0?v.innerHTML=b:v.innerHTML=""}function d(){o.isFullScreen()&&c.set(g.orientation)}function h(e,t){if(g.orientation=e,c.canOrient())d();else{var n=g.orientation;t&&(n="none"),l(n)}}function f(){r.modal({title:"HappyFunTimes",msg:"This game requires the HappyFunTimes App<br/>Please download it from your app store"},function(){var e=window.navigator.userAgent;e.indexOf("iPhone")>=0||e.indexOf("iPad")>=0?a.gotoIFrame("itms://itunes.apple.com/"):e.indexOf("Android")>=0?a.gotoIFrame("market://details?id=com.greggman.HappyFunTimes"):showRequiredApp()})}function p(e){var t=m("hft-menu");t.style.display=e?"block":"none"}var v,m=function(e){return document.getElementById(e)},g={logger:new i.NullLogger},y={},b=['<div id="hft-portrait" class="hft-fullsize hft-fullcenter">','  <div class="hft-portrait-rot90">                         ','    <div class="hft-instruction">                          ',"      Turn the Screen                                      ","    </div>                                                 ",'    <div class="hft-xlarge">                               ',"      &#x21ba;                                             ","    </div>                                                 ","  </div>                                                   ","</div>                                                     "].join("\n"),E=['<div id="hft-landscape" class="hft-fullsize hft-fullcenter">','  <div class="hft-landscape-rot90">                         ','    <div class="hft-instruction">                           ',"      Turn the Screen                                       ","    </div>                                                  ",'    <div class="hft-xlarge">                                ',"      &#x21bb;                                              ","    </div>                                                  ","  </div>                                                    ","</div>                                                      "].join("\n"),w=function(t,n){function r(t){e.sendJSON(window.location.href,{cmd:"happyFunTimesPing"},function(e,n){t(e,n)},{timeout:2e3})}n=n||{};var c=m("hft-settings"),l=m("hft-disconnected"),v=m("hft-touchstart"),b=m("hft-menu");b.addEventListener("click",function(){c.style.display="block"},!1),b.addEventListener("touchstart",function(){c.style.display="block"},!1),p(!1);var E=function(){o.isFullScreen()||(v.removeEventListener("touchstart",E,!1),v.style.display="none",o.requestFullScreen(document.body))},w=function(){o.isFullScreen()?d():o.canGoFullScreen()&&(v.addEventListener("touchstart",E,!1),v.style.display="block")};if(o.onFullScreenChange(document.body,w),s.isMobile()&&w(),y.playerNameHandler=new u(t,m("hft-name")),m("hft-setname").addEventListener("click",function(){c.style.display="none",y.playerNameHandler.startNameEntry()},!1),m("hft-restart").addEventListener("click",function(){window.location.reload()},!1),m("hft-back").addEventListener("click",function(){c.style.display="none"}),t.addEventListener("connect",function(){l.style.display="none",n.connectFn&&n.connectFn()}),t.addEventListener("disconnect",function(){function e(){r(function(t,n){return t?(setTimeout(e,1e3),void 0):(window.location.href="/",void 0)})}l.style.display="block",n.disconnectFn&&n.disconnectFn(),setTimeout(e,2e3)}),t.addEventListener("_hft_redirect_",function(e){window.location.href=e.url}),h(n.orientation,n.orientationOptional),n.requireApp&&f(),n.debug){g.statusNode=document.createTextNode(""),m("hft-status").appendChild(g.statusNode);var S=a.findCSSStyleRule("#hft-debug");S.style.display="block",g.logger=new i.HTMLLogger(m("hft-console"),n.numConsoleLines)}if(n.consoleTarget){switch(n.consoleTarget.toLowerCase()){case"html":g.logger=g.logger||new i.HTMLLogger(m("hft-console"),n.numConsoleLines),console.log=g.logger.log.bind(g.logger),console.error=g.logger.error.bind(g.logger),window.addEventListener("error",function(e,t,n){console.error(t,n,e)});break;case"game":g.logger=new i.GameLogger(t),console.log=g.logger.log.bind(g.logger),console.error=g.logger.error.bind(g.logger),window.addEventListener("error",function(e,t,n){console.error(t,n,e)})}console.log("here")}},S=function(){S=function(){},y.playerNameHandler.isNameSet()||y.playerNameHandler.startNameEntry()},T=function(e){g.statusNode&&(g.statusNode.nodeValue=e)},P=function(e){g.logger.log(e)},I=function(e){g.logger.error(e)};return{askForNameOnce:S,log:P,error:I,setOrientation:h,setStatus:T,setupStandardControllerUI:w,showMenu:p}}.apply(t,r),!(void 0!==o&&(e.exports=o))},function(e,t,n){var r;"use strict",r=function(){var e=function(){};e.prototype.log=function(){},e.prototype.error=function(){};var t=function(){};t.prototype.log=function(){console.log.apply(console,arguments)},t.prototype.error=function(){console.error.apply(console,arguments)};var n=function(e,t){this.container=e,this.maxLines=t||10,this.lines=[]};n.prototype.addLine_=function(e,t){var n,r;this.lines.length<this.maxLines?(n=document.createElement("div"),r=document.createTextNode(""),n.appendChild(r)):(n=this.lines.shift(),n.parentNode.removeChild(n),r=n.firstChild),this.lines.push(n),r.nodeValue=e,n.style.color=t,this.container.appendChild(n)};var r=function(e){for(var t=!1,n=e.length,r=[],o=0;n>o;++o){var i=e[o];void 0===i?r.push("undefined"):"number"==typeof i?(t&&r.push(", "),i===Math.floor(i)?r.push(i.toFixed(0)):r.push(i.toFixed(3)),t=!0):window.Float32Array&&i instanceof Float32Array?r.push(tdl.string.argsToString(i)):(r.push(i.toString()),t=!1)}return r.join("")};n.prototype.log=function(){this.addLine_(r(arguments),void 0)},n.prototype.error=function(){this.addLine_(r(arguments),"red")};var o=function(e){this.log=e.logImpl.bind(e),this.error=e.errorImpl.bind(e)};return{ConsoleLogger:t,GameLogger:o,HTMLLogger:n,NullLogger:e}}.call(t,n,t,e),!(void 0!==r&&(e.exports=r))},function(e,t,n){var r;"use strict",r=function(){var e=function(){},t=function(t,n,r,o){o=o||{};var i=new XMLHttpRequest;i.overrideMimeType&&i.overrideMimeType("text/plain");var a=o.timeout||0;a&&(i.timeout=a,e("set timeout to: "+i.timeout)),i.open("POST",t,!0);var s=JSON.stringify(n),c=function(t,n){r&&(e("calling-callback:"+(t?" has error":"success")),r(t,n),r=void 0)},u=function(){e("--error--"),c("error sending json to "+t)},l=function(){e("--timeout--"),c("timeout sending json to "+t)},d=function(){r&&(e("--forced timeout--"),i.abort(),c("forced timeout sending json to "+t))},h=function(){e("--finish--");var n=void 0,r=200===i.status||0===i.status;if(r)try{n=JSON.parse(i.responseText)}catch(o){r=!1}c(r?null:"could not load: "+t,n)};try{a&&setTimeout(d,a+50),i.addEventListener("load",h,!1),i.addEventListener("timeout",l,!1),i.addEventListener("error",u,!1),i.setRequestHeader("Content-type","application/json"),i.send(s),e("--sent: "+t)}catch(f){e("--exception--"),setTimeout(function(){c("could not load: "+t,null)},0)}};return{sendJSON:t}}.call(t,n,t,e),!(void 0!==r&&(e.exports=r))},function(e,t,n){var r;r=function(){var e=function(e,t){var n=t||"/";this.set=function(t,r){if(void 0===t)return this.erase(),void 0;if(window.hftSettings&&window.hftSettings.inApp)return window.localStorage.setItem(e,t),void 0;var o="";r=r||9999;var i=new Date;i.setTime(Date.now()+Math.floor(24*r*60*60*1e3)),o="; expires="+i.toGMTString();var a=encodeURIComponent(e)+"="+encodeURIComponent(t)+o+"; path="+n;document.cookie=a},this.get=function(){if(window.hftSettings&&window.hftSettings.inApp)return window.localStorage.getItem(e);for(var t=encodeURIComponent(e)+"=",n=document.cookie.split(";"),r=0;r<n.length;++r){for(var o=n[r];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(t))return decodeURIComponent(o.substring(t.length,o.length))}},this.erase=function(){return window.hftSettings&&window.hftSettings.inApp?window.localStorage.removeItem(e):(document.cookie=this.set(" ",-1),void 0)}};return e}.call(t,n,t,e),!(void 0!==r&&(e.exports=r))},function(e,t,n){var r,o;"use strict",r=[],o=function(){function e(e,t){var n=document.createElement(e);t.className&&(n.className=t.className);var r=t.style;return r&&Object.keys(r).forEach(function(e){n.style[e]=r[e]}),t.parent&&t.parent.appendChild(n),n}function t(t,n){var r=e("div",n);return t instanceof HTMLElement?r.appendChild(t):r.innerHTML=t,r}function n(e){e.parentNode.removeChild(e),--o}function r(r,i){function a(e,r){var o=t("div",{className:"hft-dialog-choice",parent:l});o.innerHTML=e.msg;var a=function(){n(c),(e.callback||i)(r)};return o.addEventListener("click",a),o.addEventListener("touchend",a),o}function s(e,t){a({msg:e,callback:function(){i(t)}})}i||(i=function(){});var c=e("div",{className:"hft-dialog-cover",style:{zIndex:o++}}),u=e("div",{className:"hft-fullcenter",parent:c}),l=e("div",{className:"hft-dialog-container",parent:u}),d=function(){n(c),i()};r.title&&t(r.title,{className:"hft-dialog-title",parent:l}),t(r.msg,{className:"hft-dialog-content",parent:l}),r.choices?r.choices.forEach(function(e,t){"string"==typeof e?s(e,t):a(e,t)}):i&&(l.addEventListener("click",d,!1),l.addEventListener("touchend",d,!1)),document.body.appendChild(c)}var o=15e3;return{modal:r}}.apply(t,r),!(void 0!==o&&(e.exports=o))},function(e,t,n){var r,o;"use strict",r=[n(7)],o=function(e){function t(){var t=document.fullscreenElement||document.fullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.webkitIsFullScreen;return void 0!==t&&null!==t&&t!==!1||e.isApp}function n(){var e=window.document.body||{},t=e.requestFullscreen||e.requestFullScreen||e.msRequestFullscreen||e.msRequestFullScreen||e.webkitRequestFullScreen||e.webkitRequestFullscreen||e.mozRequestFullScreen||e.mozRequestFullscreen;return void 0!==t&&null!==t}var r=function(e){e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):e.webkitRequestFullscreen?e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):e.mozRequestFullScreen?e.mozRequestFullScreen():e.mozRequestFullscreen&&e.mozRequestFullscreen()},o=function(){},i=(document.exitFullscreen||document.exitFullScreen||document.msExitFullscreen||document.msExitFullScreen||document.webkitCancelFullscreen||document.webkitCancelFullScreen||document.mozCancelFullScreen||document.mozCancelFullscreen||o).bind(document),a=function(e,n){document.addEventListener("fullscreenchange",function(){n(t())}),e.addEventListener("webkitfullscreenchange",function(){n(t())}),document.addEventListener("mozfullscreenchange",function(){n(t())})};return{cancelFullScreen:i,isFullScreen:t,canGoFullScreen:n,onFullScreenChange:a,requestFullScreen:r}}.apply(t,r),!(void 0!==o&&(e.exports=o))},function(e,t,n){var r,o;"use strict",function(n){r=[],o=function(){return void 0===n&&(n={}),n.hftSettings=n.hftSettings||{},n.hftSettings}.apply(t,r),!(void 0!==o&&(e.exports=o))}(this)},function(e,t,n){var r;"use strict",r=function(){return console.log(["%c","---------------------------------------------------------------------------------------------","If you'd like to know more about this sytem check out http://docs.happyfuntimes.net/docs","---------------------------------------------------------------------------------------------",""].join("\n"),"color:blue; font-weight: bold;"),{}}.call(t,n,t,e),!(void 0!==r&&(e.exports=r))},function(e,t,n){var r;"use strict",r=function(){function e(e,t){"?"===e[0]&&(e=e.substring(1));var n=t||{};return e.split("&").forEach(function(e){var t=e.split("=").map(decodeURIComponent);n[t[0]]=void 0!==t[1]?t[1]:!0}),n}function t(e){return"?"+Object.keys(e).filter(function(t){return void 0!==e[t]}).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}function n(e,t){for(var n=t.substr(0,1).toUpperCase()+t.substr(1),r=0;r<p.length;++r){var o=p[r],i=o+o?n:t,a=e[i];if(a)return a.bind(e)}}function r(e){var t=document.createElement("iframe");return t.style.display="none",t.src=e,document.body.appendChild(t),t}function o(e){return e[v(e.length)]}function i(e,t){return Object.keys(e).forEach(function(n){t[n]=e[n]}),t}function a(e){var t={};return Array.prototype.slice.call(arguments).forEach(function(e){e&&i(e,t)}),t}function s(e){e=e||16;for(var t="",n=0;e>n;++n)t+=(16*Math.random()|0).toString(16);return t}function c(e,t){Object.keys(t).forEach(function(n){e.addEventListener(n,t[n])})}var u=function(e,t,n){return Object.keys(e).forEach(function(r){if(2!==n||void 0===t[r]){var o=e[r];if(o instanceof Array){var i=t[r];i||(i=[],t[name]=i),u(o,i,n)}else if(!(o instanceof Object)||o instanceof Function||o instanceof HTMLElement){if(1===n&&void 0!==t[r])return;t[r]=o}else{var a=t[r];a||(a={},t[r]=a),u(o,a,n)}}}),t},l=function(t,n){var r=n||{};try{var o=t.indexOf("?"),i=t.indexOf("#");0>i&&(i=t.length);var a=t.substring(o+1,i);e(a,r)}catch(i){console.error(i)}return r},d=function(t){return e(window.location.search,t)},h=new RegExp("([a-zA-Z0-9_]+):","g"),f=function(e,t){var n=t||"settings",r=d(),o=e||{},i=r[n];if(i){var a=i.replace(h,'"$1":'),s=JSON.parse(a);u(s,o)}return o},p=["","moz","webkit","ms"],v=function(e){return Math.floor(Math.random()*e)},m=function(e){for(var t=e||v,n=t(3),r=[],o=0;3>o;++o)r.push(t(128)+(o===n?128:64));return"rgb("+r.join(",")+")"},g=function(e){for(var t=e||v,n=t(3),r=255,o=0;3>o;++o)r=r<<8|t(128)+(o===n?128:64);return r},y=function(e){for(var t=0;t<document.styleSheets.length;++t){var n=document.styleSheets[t],r=n.cssRules||n.rules;if(r)for(var o=0;o<r.length;++o){var i=r[o];if(i.selectorText===e)return i}}},b=function(e){var t=document.createTextNode("");return e.appendChild(t),t},E=function(e){var t={x:e.offsetLeft,y:e.offsetTop};if(e.offsetParent){var n=E(e.offsetParent);t.x+=n.x,t.y+=n.y}return t},w=function(e,t,n){return Math.max(t,Math.min(n,e))},S=function(e,t){return w(e,-t,t)},T=function(e){return 0>e?-1:e>0?1:0},P=function(e,t){return Math.abs(e)<Math.abs(t)?e:t},I=function(e,t){return T(e)*(t-Math.min(t,Math.abs(e)))},C=function(e){return e*Math.PI/180},x=function(e){return 180*e/Math.PI},k=function(e,t){var n=t?window.devicePixelRatio:1;n=n||1;var r=Math.floor(e.clientWidth*n),o=Math.floor(e.clientHeight*n);return e.width!==r||e.height!==o?(e.width=r,e.height=o,!0):void 0};return{applyObject:i,applyUrlSettings:f,applyListeners:c,clamp:w,clampPlusMinus:S,copyProperties:u,createTextNode:b,degToRad:C,findCSSStyleRule:y,getAbsolutePosition:E,getFunctionByPrefix:n,gotoIFrame:r,invertPlusMinusRange:I,makeRandomId:s,mergeObjects:a,minToZero:P,objectToSearchString:t,parseUrlQuery:d,parseUrlQueryString:l,pickRandomElement:o,radToDeg:x,randInt:v,randCSSColor:m,rand32BitColor:g,resize:k,sign:T,searchStringToObject:e}}.call(t,n,t,e),!(void 0!==r&&(e.exports=r))},function(e,t,n){var r;"use strict",r=function(){function e(e){return e.preventDefault(),!1}function t(){Array.prototype.forEach.call(document.getElementsByTagName("img"),function(t){t.addEventListener("contextmenu",e,!1)})}var n=document.getElementById.bind(document),r=function(){var e=480===window.screen.height,t=568===window.screen.height,n=function(){if(/iP(hone|od|ad)/.test(navigator.platform)){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return parseInt(e[1],10)>=8}}();return n&&(e||t)}(),o=function(){return r},i=function(){var e=/iP(hone|od|ad)/i.test(navigator.platform);return function(){return e}}(),a=function(){var e=/Android|webOS|Phone|Pad|Pod|Tablet|BlackBerry/i.test(navigator.userAgent);return function(){return e}}(),s=function(){for(var e=document.querySelectorAll(".fixheight"),t=0;t<e.length;++t){var n=e[t],r=n.parentNode;parseInt(n.style.height)!==r.clientHeight&&(n.style.height=r.clientHeight+"px")}},c=function(e){e.forEach(function(e){e.test()&&Array.prototype.forEach.call(document.styleSheets,function(t){var n=t.rules||document.sheet.cssRules;Array.prototype.forEach.call(n,function(t){var n=e.styles[t.selectorText];n&&Object.keys(n).forEach(function(e){t.style.setProperty?t.style.setProperty(e,n[e]):t.style[e]=n[e]})})})})},u=function(){window.scrollTo(0,0),s(),window.scrollTo(0,0)};window.addEventListener("orientationchange",u,!1),window.addEventListener("resize",u,!1);var l=function(){document.body?document.body.addEventListener("touchmove",function(e){e.preventDefault()},!1):setTimeout(l,4)};l();var d=function(){var e=n("hft-everything"),t=function(){if(screen.width<screen.height){e.className="hft-portrait-to-landscape",e.style.width=window.innerHeight+"px",e.style.height=window.innerWidth+"px";var t=document.querySelector("meta[name=viewport]");t.setAttribute("content","width=device-height, initial-scale=1.0, maximum-scale=1, user-scalable=no, minimal-ui")}else e.className=""};t(),window.addEventListener("resize",t,!1)};return window.scrollTo(0,0),{disableContextMenu:t,fixHeightHack:s,forceLandscape:d,adjustCSSBasedOnPhone:c,isIOS8OrNewerAndiPhone4OrIPhone5:o,isIOS:i,isMobile:a}}.call(t,n,t,e),!(void 0!==r&&(e.exports=r))},function(e,t,n){var r,o;"use strict",r=[n(7),n(9)],o=function(e,t){function n(e){e=e||"none",e!==a&&(a=e,"none"===a?(console.log("unlock orienation"),i()):(console.log("set orienation: "+e),o(e)))}function r(){return s}var o=t.getFunctionByPrefix(window.screen,"lockOrientation"),i=t.getFunctionByPrefix(window.screen,"unlockOrientation"),a="none",s=!0;return!e.isApp&&window.screen.orientation&&window.screen.orientation.lock&&(o=function(e){window.screen.orientation.lock(e).then(function(){console.log("orientation set")},function(e){console.error("can not set orientation:",e)})},i=function(){window.screen.orientation.unlock().then(function(){console.log("orientation unlocked")},function(e){console.error("can not unlock orientation:",e)})}),o||(s=!1,o=function(){console.warn("orientation locking not supported")},i=function(){}),{set:n,canOrient:r}}.apply(t,r),!(void 0!==o&&(e.exports=o))},function(e,t,n){var r,o;"use strict",r=[n(4),n(9)],o=function(e,t){var n=function(e){return document.getElementById(e)},r=t.parseUrlQuery(),o=["Aaron","Momo","Michael","Remi","Matt","Aya","John","Stephanie","Brian","Anna","Danny","Jen","Gregg","Tami","Vincent","Carole","Eric","Anita","Rick","Joss","Colin","Angel"],i=function(i,a){function s(){return u&&!p.test(u)}var c=new e("name"),u=c.get()||r.name||"",l=n("hft-nameentry"),d=n("hft-content"),h=d.style.display,f=function(){a.value=u};this.getName=function(){return u};var p=/^player\d*$/i;this.isNameSet=s;var v=function(e){u=e.name,f()},m=function(){i.sendCmd("_hft_setname_",{name:u})},g=function(e){i.sendCmd("_hft_busy_",{busy:e})},y=function(){g(!0)},b=function(e){d.style.display=h,l.style.display="none",window.scroll(0,1),window.scroll(0,0),e.preventDefault(),a.blur();var t=a.value.replace(/[<>]/g,"");t.length>16&&(t=t.substring(0,16)),0===t.length?a.value=u:t!==u&&(u=t,c.set(u,700),m()),g(!1)};this.startNameEntry=function(){l.style.display="block",d.style.display="none",s()||(a.value=t.pickRandomElement(o)),a.focus()},i.addEventListener("_hft_setname_",v),a.addEventListener("click",y,!1),a.addEventListener("change",b,!1),a.addEventListener("blur",b,!1),a.addEventListener("focus",y,!1),a.form&&a.form.addEventListener("submit",b,!1),f(),m()};return i}.apply(t,r),!(void 0!==o&&(e.exports=o))},function(e,t,n){var r,o;"use strict",r=[],o=function(){var e=function(e,t,n,r,o){o=o||1,e.beginPath(),e.arc(t,n,r,0,2*Math.PI),1&o&&e.fill(),2&o&&e.stroke()},t=function(e){this.element=e.element,this.size=e.size,this.canvas=document.createElement("canvas"),this.element.appendChild(this.canvas),this.resize(),this.ctx=this.canvas.getContext("2d"),this.drawBits(0)};return t.prototype.getSize=function(){var e=this.size;return e||(e=Math.min(this.canvas.width,this.canvas.height)),e},t.prototype.drawBits=function(t){var n=this.getSize(),r=Math.floor(n/6.5),o=Math.floor(n/2),i=Math.floor(n/2),a=Math.floor(n/2*.8),s=Math.floor(n/2*.8),c=this.ctx;c.clearRect(0,0,c.canvas.width,c.canvas.height),c.save(),c.translate(o,i),c.fillStyle="#AAA",c.stokeStyle="#444",e(c,0,0,.95*o,3),c.fillStyle="#888",c.fillRect(-r,-s,2*r,2*s),c.fillRect(-a,-r,2*a,2*r),c.fillStyle="#CCC",1&t&&e(c,a-r,0,.8*r),2&t&&e(c,-a+r,0,.8*r),4&t&&e(c,0,-a+r,.8*r),8&t&&e(c,0,a-r,.8*r),c.restore()},t.prototype.draw=function(e){this.drawBits(e.bits)},t.prototype.resize=function(){var e=this.size;e||(e=Math.min(this.canvas.clientWidth,this.canvas.clientHeight)),this.canvas.width===e&&this.canvas.height===e||(this.canvas.width=e,this.canvas.height=e)},t}.apply(t,r),!(void 0!==o&&(e.exports=o))},function(e,t,n){var r,o;"use strict",r=[n(9)],o=function(e){var t={kLeft:37,kRight:39,kUp:38,kDown:40},n=[37,39,38,40],r=[65,68,87,83],o={pads:[{keys:r}]},i={pads:[{keys:n}]},a=/^\d+$/,s=1,c=2,u=4,l=8,d={};d[-1]={direction:-1,dx:0,dy:0,bits:0,symbol:String.fromCharCode(10065)},d[0]={direction:0,dx:1,dy:0,bits:s,symbol:String.fromCharCode(8594)},d[1]={direction:1,dx:1,dy:1,bits:u|s,symbol:String.fromCharCode(8599)},d[2]={direction:2,dx:0,dy:1,bits:u,symbol:String.fromCharCode(8593)},d[3]={direction:3,dx:-1,dy:1,bits:u|c,symbol:String.fromCharCode(8598)},d[4]={direction:4,dx:-1,dy:0,bits:c,symbol:String.fromCharCode(8592)},d[5]={direction:5,dx:-1,dy:-1,bits:l|c,symbol:String.fromCharCode(8601)},d[6]={direction:6,dx:0,dy:-1,bits:l,symbol:String.fromCharCode(8595)},d[7]={direction:7,dx:1,dy:-1,bits:l|s,symbol:String.fromCharCode(8600)};var h=function(e){return{pad:e,info:void 0}},f=function(e,t,n,r){var o=d[t];n.pad=e,n.info=o,r(n)},p=function(e){return d[e]},v=function(t,n){var r=e.getAbsolutePosition(t),o=n.pageX-r.x,i=n.pageY-r.y;return{x:o,y:i}},m=function(e,t){var n={},r={},o=function(o,i){n[o]=i,r!==n&&(r=i,i?e(o):t(o))},i=function(e){o(e.keyCode,!1)},a=function(e){o(e.keyCode,!0)};window.addEventListener("keyup",i,!1),window.addEventListener("keydown",a,!1)},g=function(t,o){o||(o={pads:[{keys:r},{keys:n}]});for(var i=[],a=[],s=[],c=[],u=[{bit:1,exclude:2,mask:3},{bit:2,exclude:1,mask:3},{bit:4,exclude:8,mask:12},{bit:8,exclude:4,mask:12}],l={},d=0;d<o.pads.length;++d){var p=o.pads[d];i.push(0),a.push(0),s.push(-1),c.push(h(d));for(var v=0;4>v;++v){var g=u[v],y={pad:d};e.copyProperties(g,y),l[p.keys[v]]=y}}var b=[-1,4,0,-1,2,3,1,-1,6,5,7,-1,-1,-1,-1,-1],E=function(e,n){var r=l[e];if(r){var o=r.pad,u=r.bit,d=i[o];if(n?(d|=u,a[o]=a[o]&~r.mask|r.exclude):(d&=~u,a[o]&=~r.mask),d!==i[o]){i[o]=d;var h=b[d&~a[o]];h!==s[o]&&(s[o]=h,f(o,h,c[o],t))}}},w=function(e){E(e,0)},S=function(e){E(e,1)};m(S,w)},y=function(e){var t={};Object.keys(e).forEach(function(n){var r=e[n];if(!a.test(n)){if(1!==n.length)throw"bad key code: '"+n+"'";n=n.charCodeAt(0)}t[n]=r});var n=function(e,n,r){var o=t[e];o&&o({keyCode:e,pressed:r})},r=function(e,t){n(e,t,!0)},o=function(e,t){n(e,t,!1)};m(r,o)};return{cursorKeys:t,createDirectionEventInfo:h,emitDirectionEvent:f,getDirectionInfo:p,kCursorKeys:n,kCursorPadOnly:i,kASWDKeys:r,kASWDPadOnly:o,getRelativeCoordinates:v,setupControllerKeys:m,setupKeyboardDPadKeys:g,setupKeys:y}}.apply(t,r),!(void 0!==o&&(e.exports=o))},function(e,t,n){var r;"use strict",r=function(){var e=function(){var e={};return function(t,n){var r=e[t];return(!r||r.length<n)&&(r=new Array(n+1).join(t),e[t]=r),r}}(),t=function(e){return"string"==typeof e?e:e.toString()},n=function(n,r,o){if(n=t(n),n.length>=r)return n;var i=e(o,r);return n+i.substr(n.length-r)},r=function(n,r,o){if(n=t(n),n.length>=r)return n;var i=e(o,r);return i.substr(n.length-r)+n},o=function(){var e=/%\(([^\)]+)\)s/g;return function(t,n){return n.length||(n=[n]),t.replace(e,function(e,t){for(var r=t.split("."),o=0;o<n.length;++o){for(var i=n[o],a=0;a<r.length;++a){var s=r[a];if(i=i[s],void 0===i)break}if(void 0!==i)return i}return console.error("unknown key: "+t),"%("+t+")s"})}}(),i=function(e,t){return e.length>=t.length&&e.substr(0,t.length)===t},a=function(e,t){return e.length>=t.length&&e.substring(e.length-t.length)===t},s=String.fromCodePoint?String.fromCodePoint:function(){var e=String.fromCharCode,t=Math.floor,n=function(){var n,r,o=16384,i=[],a=-1,s=arguments.length;if(!s)return"";for(var c="";++a<s;){var u=Number(arguments[a]);if(!isFinite(u)||0>u||u>1114111||t(u)!==u)throw new RangeError("Invalid code point: "+u);65535>=u?i.push(u):(u-=65536,n=(u>>10)+55296,r=u%1024+56320,i.push(n,r)),(a+1===s||i.length>o)&&(c+=e.apply(null,i),i.length=0)}return c};return n}(),c={endsWith:a,fromCodePoint:s,padLeft:r,padRight:n,replaceParams:o,startsWith:i};return c}.call(t,n,t,e),!(void 0!==r&&(e.exports=r))},function(e,t,n){var r,o;"use strict",r=[n(17),n(14),n(9)],o=function(e,t,n){var r=function(e){var n=e.callback,r=e.inputElement;e.deadSpaceRadius=e.deadSpaceRadius||10;var o=e.deadSpaceRadius*e.deadSpaceRadius,i=function(e,t){this.reset(e,t)};i.prototype.reset=function(e,t){return this.x=e,this.y=t,this},i.prototype.copyFrom=function(e){this.x=e.x,this.y=e.y},i.prototype.minusEq=function(e){return this.x-=e.x,this.y-=e.y,this};for(var a=function(e){return{pointerId:-1,pointerPos:new i(0,0),pointerStartPos:new i(0,0),vector:new i(0,0),dir:-1,lastDir:0,event:t.createDirectionEventInfo(e)}},s=[],c=0;c<e.pads.length;++c)s.push(a(c));var u=function(e,t){var n=Math.atan2(-t,e)+2*Math.PI+Math.PI/8;return Math.floor(n/(Math.PI/4))%8},l=function(e,t){return Math.abs(e)<Math.abs(t)?0>t?2:6:0>e?4:0},d=[3,4,2,-1,1,0,2,-1,5,4,6,-1,7,0,6,-1],h=function(t,n){var r=Math.abs(n)<e.axisSize/2?1:0,o=Math.abs(t)<e.axisSize/2?2:0,i=r|o|(t>0?4:0)|(n>0?8:0);return d[i]},f=e.axisSize?h:u;4===e.divisions&&(f=l);var p=function(e,r){var o=s[e];t.emitDirectionEvent(e,r,o.event,n)},v=function(e,t,n){var r=-1;if(!n&&e.pointerId>=0){var i=e.vector.x*e.vector.x+e.vector.y*e.vector.y;i>o&&(r=f(e.vector.x,e.vector.y),e.lastDir=r)}e.dir!==r&&(e.dir=r,p(t,r))},m=function(n,r){var o=s[n],i=e.pads[n];o.pointerId=r.pointerId;var a=t.getRelativeCoordinates(i.referenceElement,r),c=a.x-(i.offsetX||i.referenceElement.clientWidth/2),u=a.y-(i.offsetY||i.referenceElement.clientHeight/2);e.fixedCenter?(o.pointerStartPos.reset(0,0),o.pointerPos.reset(c,u),o.vector.reset(c,u),v(o,n)):(o.pointerStartPos.reset(c,u),o.pointerPos.copyFrom(o.pointerStartPos),o.vector.reset(0,0),o.dir=o.lastDir,p(n,o.lastDir))},g=function(n){for(var r,o=0,i=0;i<s.length;++i){var a=e.pads[i],c=a.referenceElement,u=t.getRelativeCoordinates(c,n),l=c.clientWidth/2,d=c.clientHeight/2,h=u.x-l,f=u.y-d,p=h*h+f*f;(void 0===r||r>p)&&(r=p,o=i)}return o},y=function(e){var t=g(e);m(t,e)},b=function(n){for(var r=0;r<s.length;++r){var o=s[r];if(o.pointerId===n.pointerId){var i=e.pads[r],a=t.getRelativeCoordinates(i.referenceElement,n),c=a.x-(i.offsetX||i.referenceElement.clientWidth/2),u=a.y-(i.offsetY||i.referenceElement.clientHeight/2);o.pointerPos.reset(c,u),o.vector.copyFrom(o.pointerPos),o.vector.minusEq(o.pointerStartPos),v(o,r)}}},E=function(e){for(var t=0;t<s.length;++t){var n=s[t];n.pointerId===e.pointerId&&(n.pointerId=-1,n.vector.reset(0,0),v(n,t))}},w=function(e){for(var t=0;t<s.length;++t){var n=s[t];n.pointerId===e.pointerId&&v(n,t,!0)}};r.addEventListener("pointerdown",y,!1),r.addEventListener("pointermove",b,!1),r.addEventListener("pointerup",E,!1),r.addEventListener("pointerout",w,!1)},o=function(e){for(var t=[],r=e.buttons,o=0;o<r.length;++o){var i=r[o],a={pointerIds:{},numPointerIds:0};n.copyProperties(i,a),t.push(a)}var s=function(e,t,n){e.pointerIds[t]||(e.pointerIds[t]=n,++e.numPointerIds,e.callback({pressed:!0}))},c=function(e,t){if(e.pointerIds[t])if(delete e.pointerIds[t],--e.numPointerIds,0===e.numPointerIds)e.callback({pressed:!1});else if(e.numPointerIds<0)throw"numPointerIds went negative: how did I get here!?"},u=function(e,t){s(t,e.pointerId,e.timeStamp)},l=function(e,t){c(t,e.pointerId,e.timeStamp)},d=function(){},h=function(e,t){c(t,e.pointerId,e.timeStamp)},f=function(e,t){s(t,e.pointerId,e.timeStamp)},p=function(e,t){c(t,e.pointerId,e.timeStamp)},v=function(e,t){c(t,e.pointerId,e.timeStamp)},m={pointerdown:u,pointermove:d,pointerup:l,pointerout:h,pointerenter:f,pointerleave:p,pointercancel:v};t.forEach(function(e){var t=e.element;Object.keys(m).forEach(function(n){var r=m[n];t.addEventListener(n,function(e){return function(t){r(t,e)}}(e))})})};return{setupVirtualDPads:r,setupButtons:o}}.apply(t,r),!(void 0!==o&&(e.exports=o))},function(e,t,n){!function(t,n){e.exports=n()}(this,function(){"use strict";function e(e,t){t=t||Object.create(null);var n=document.createEvent("Event");n.initEvent(e,t.bubbles||!1,t.cancelable||!1);for(var r,o=2;o<l.length;o++)r=l[o],n[r]=t[r]||d[o];n.buttons=t.buttons||0;var i=0;return i=t.pressure?t.pressure:n.buttons?.5:0,n.x=n.clientX,n.y=n.clientY,n.pointerId=t.pointerId||0,n.width=t.width||0,n.height=t.height||0,n.pressure=i,n.tiltX=t.tiltX||0,n.tiltY=t.tiltY||0,n.pointerType=t.pointerType||"",n.hwTimestamp=t.hwTimestamp||0,n.isPrimary=t.isPrimary||!1,n}function t(){this.array=[],this.size=0}function n(e,t,n,r){this.addCallback=e.bind(r),this.removeCallback=t.bind(r),this.changedCallback=n.bind(r),x&&(this.observer=new x(this.mutationWatcher.bind(this)))}function r(e){return"body /shadow-deep/ "+o(e)}function o(e){return'[touch-action="'+e+'"]'}function i(e){return"{ -ms-touch-action: "+e+"; touch-action: "+e+"; touch-action-delay: none; }"}function a(){if(F){O.forEach(function(e){String(e)===e?(R+=o(e)+i(e)+"\n",N&&(R+=r(e)+i(e)+"\n")):(R+=e.selectors.map(o)+i(e.rule)+"\n",N&&(R+=e.selectors.map(r)+i(e.rule)+"\n"))});var e=document.createElement("style");e.textContent=R,document.head.appendChild(e)}}function s(){if(!window.PointerEvent){if(window.PointerEvent=h,window.navigator.msPointerEnabled){var e=window.navigator.msMaxTouchPoints;Object.defineProperty(window.navigator,"maxTouchPoints",{value:e,enumerable:!0}),w.registerSource("ms",oe)}else w.registerSource("mouse",X),void 0!==window.ontouchstart&&w.registerSource("touch",ee);w.register(document)}}function c(e){if(!w.pointermap.has(e))throw new Error("InvalidPointerId")}function u(){window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:Q},releasePointerCapture:{value:Z}})}var l=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pageX","pageY"],d=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0],h=e,f=window.Map&&window.Map.prototype.forEach,p=f?Map:t;t.prototype={set:function(e,t){return void 0===t?this["delete"](e):(this.has(e)||this.size++,void(this.array[e]=t))},has:function(e){return void 0!==this.array[e]},"delete":function(e){this.has(e)&&(delete this.array[e],this.size--)},get:function(e){return this.array[e]},clear:function(){this.array.length=0,this.size=0},forEach:function(e,t){return this.array.forEach(function(n,r){e.call(t,n,r,this)},this)}};var v=p,m=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","buttons","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","type","target","currentTarget","which","pageX","pageY","timeStamp"],g=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],y={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},b="undefined"!=typeof SVGElementInstance,E={pointermap:new v,eventMap:Object.create(null),
captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(e,t){var n=t,r=n.events;r&&(r.forEach(function(e){n[e]&&(this.eventMap[e]=n[e].bind(n))},this),this.eventSources[e]=n,this.eventSourceList.push(n))},register:function(e){for(var t,n=this.eventSourceList.length,r=0;n>r&&(t=this.eventSourceList[r]);r++)t.register.call(t,e)},unregister:function(e){for(var t,n=this.eventSourceList.length,r=0;n>r&&(t=this.eventSourceList[r]);r++)t.unregister.call(t,e)},contains:function(e,t){try{return e.contains(t)}catch(n){return!1}},down:function(e){e.bubbles=!0,this.fireEvent("pointerdown",e)},move:function(e){e.bubbles=!0,this.fireEvent("pointermove",e)},up:function(e){e.bubbles=!0,this.fireEvent("pointerup",e)},enter:function(e){e.bubbles=!1,this.fireEvent("pointerenter",e)},leave:function(e){e.bubbles=!1,this.fireEvent("pointerleave",e)},over:function(e){e.bubbles=!0,this.fireEvent("pointerover",e)},out:function(e){e.bubbles=!0,this.fireEvent("pointerout",e)},cancel:function(e){e.bubbles=!0,this.fireEvent("pointercancel",e)},leaveOut:function(e){this.out(e),this.contains(e.target,e.relatedTarget)||this.leave(e)},enterOver:function(e){this.over(e),this.contains(e.target,e.relatedTarget)||this.enter(e)},eventHandler:function(e){if(!e._handledByPE){var t=e.type,n=this.eventMap&&this.eventMap[t];n&&n(e),e._handledByPE=!0}},listen:function(e,t){t.forEach(function(t){this.addEvent(e,t)},this)},unlisten:function(e,t){t.forEach(function(t){this.removeEvent(e,t)},this)},addEvent:function(e,t){e.addEventListener(t,this.boundHandler)},removeEvent:function(e,t){e.removeEventListener(t,this.boundHandler)},makeEvent:function(e,t){this.captureInfo[t.pointerId]&&(t.relatedTarget=null);var n=new h(e,t);return t.preventDefault&&(n.preventDefault=t.preventDefault),n._target=n._target||t.target,n},fireEvent:function(e,t){var n=this.makeEvent(e,t);return this.dispatchEvent(n)},cloneEvent:function(e){for(var t,n=Object.create(null),r=0;r<m.length;r++)t=m[r],n[t]=e[t]||g[r],!b||"target"!==t&&"relatedTarget"!==t||n[t]instanceof SVGElementInstance&&(n[t]=n[t].correspondingUseElement);return e.preventDefault&&(n.preventDefault=function(){e.preventDefault()}),n},getTarget:function(e){var t=this.captureInfo[e.pointerId];return t?e._target!==t&&e.type in y?void 0:t:e._target},setCapture:function(e,t){this.captureInfo[e]&&this.releaseCapture(e),this.captureInfo[e]=t;var n=document.createEvent("Event");n.initEvent("gotpointercapture",!0,!1),n.pointerId=e,this.implicitRelease=this.releaseCapture.bind(this,e),document.addEventListener("pointerup",this.implicitRelease),document.addEventListener("pointercancel",this.implicitRelease),n._target=t,this.asyncDispatchEvent(n)},releaseCapture:function(e){var t=this.captureInfo[e];if(t){var n=document.createEvent("Event");n.initEvent("lostpointercapture",!0,!1),n.pointerId=e,this.captureInfo[e]=void 0,document.removeEventListener("pointerup",this.implicitRelease),document.removeEventListener("pointercancel",this.implicitRelease),n._target=t,this.asyncDispatchEvent(n)}},dispatchEvent:function(e){var t=this.getTarget(e);return t?t.dispatchEvent(e):void 0},asyncDispatchEvent:function(e){requestAnimationFrame(this.dispatchEvent.bind(this,e))}};E.boundHandler=E.eventHandler.bind(E);var w=E,S={shadow:function(e){return e?e.shadowRoot||e.webkitShadowRoot:void 0},canTarget:function(e){return e&&Boolean(e.elementFromPoint)},targetingShadow:function(e){var t=this.shadow(e);return this.canTarget(t)?t:void 0},olderShadow:function(e){var t=e.olderShadowRoot;if(!t){var n=e.querySelector("shadow");n&&(t=n.olderShadowRoot)}return t},allShadows:function(e){for(var t=[],n=this.shadow(e);n;)t.push(n),n=this.olderShadow(n);return t},searchRoot:function(e,t,n){if(e){var r,o,i=e.elementFromPoint(t,n);for(o=this.targetingShadow(i);o;){if(r=o.elementFromPoint(t,n)){var a=this.targetingShadow(r);return this.searchRoot(a,t,n)||r}o=this.olderShadow(o)}return i}},owner:function(e){for(var t=e;t.parentNode;)t=t.parentNode;return t.nodeType!==Node.DOCUMENT_NODE&&t.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(t=document),t},findTarget:function(e){var t=e.clientX,n=e.clientY,r=this.owner(e.target);return r.elementFromPoint(t,n)||(r=document),this.searchRoot(r,t,n)}},T=Array.prototype.forEach.call.bind(Array.prototype.forEach),P=Array.prototype.map.call.bind(Array.prototype.map),I=Array.prototype.slice.call.bind(Array.prototype.slice),C=Array.prototype.filter.call.bind(Array.prototype.filter),x=window.MutationObserver||window.WebKitMutationObserver,k="[touch-action]",M={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};n.prototype={watchSubtree:function(e){this.observer&&S.canTarget(e)&&this.observer.observe(e,M)},enableOnSubtree:function(e){this.watchSubtree(e),e===document&&"complete"!==document.readyState?this.installOnLoad():this.installNewSubtree(e)},installNewSubtree:function(e){T(this.findElements(e),this.addElement,this)},findElements:function(e){return e.querySelectorAll?e.querySelectorAll(k):[]},removeElement:function(e){this.removeCallback(e)},addElement:function(e){this.addCallback(e)},elementChanged:function(e,t){this.changedCallback(e,t)},concatLists:function(e,t){return e.concat(I(t))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(e){return e.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(e){var t=P(e,this.findElements,this);return t.push(C(e,this.isElement)),t.reduce(this.concatLists,[])},mutationWatcher:function(e){e.forEach(this.mutationHandler,this)},mutationHandler:function(e){if("childList"===e.type){var t=this.flattenMutationTree(e.addedNodes);t.forEach(this.addElement,this);var n=this.flattenMutationTree(e.removedNodes);n.forEach(this.removeElement,this)}else"attributes"===e.type&&this.elementChanged(e.target,e.oldValue)}};var L=n,O=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],R="",F=window.PointerEvent||window.MSPointerEvent,N=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,A=w.pointermap,_=25,D=[1,4,2,8,16],Y=!1;try{Y=1===new MouseEvent("test",{buttons:1}).buttons}catch(H){}var z,q={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(e){w.listen(e,this.events)},unregister:function(e){w.unlisten(e,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(e){for(var t,n=this.lastTouches,r=e.clientX,o=e.clientY,i=0,a=n.length;a>i&&(t=n[i]);i++){var s=Math.abs(r-t.x),c=Math.abs(o-t.y);if(_>=s&&_>=c)return!0}},prepareEvent:function(e){var t=w.cloneEvent(e),n=t.preventDefault;return t.preventDefault=function(){e.preventDefault(),n()},t.pointerId=this.POINTER_ID,t.isPrimary=!0,t.pointerType=this.POINTER_TYPE,t},prepareButtonsForMove:function(e,t){var n=A.get(this.POINTER_ID);e.buttons=n?n.buttons:0,t.buttons=e.buttons},mousedown:function(e){if(!this.isEventSimulatedFromTouch(e)){var t=A.get(this.POINTER_ID),n=this.prepareEvent(e);Y||(n.buttons=D[n.button],t&&(n.buttons|=t.buttons),e.buttons=n.buttons),A.set(this.POINTER_ID,e),t?w.move(n):w.down(n)}},mousemove:function(e){if(!this.isEventSimulatedFromTouch(e)){var t=this.prepareEvent(e);Y||this.prepareButtonsForMove(t,e),w.move(t)}},mouseup:function(e){if(!this.isEventSimulatedFromTouch(e)){var t=A.get(this.POINTER_ID),n=this.prepareEvent(e);if(!Y){var r=D[n.button];n.buttons=t?t.buttons&~r:0,e.buttons=n.buttons}A.set(this.POINTER_ID,e),0===n.buttons||n.buttons===D[n.button]?(this.cleanupMouse(),w.up(n)):w.move(n)}},mouseover:function(e){if(!this.isEventSimulatedFromTouch(e)){var t=this.prepareEvent(e);Y||this.prepareButtonsForMove(t,e),w.enterOver(t)}},mouseout:function(e){if(!this.isEventSimulatedFromTouch(e)){var t=this.prepareEvent(e);Y||this.prepareButtonsForMove(t,e),w.leaveOut(t)}},cancel:function(e){var t=this.prepareEvent(e);w.cancel(t),this.cleanupMouse()},cleanupMouse:function(){A["delete"](this.POINTER_ID)}},X=q,j=w.captureInfo,B=S.findTarget.bind(S),U=S.allShadows.bind(S),K=w.pointermap,W=2500,G=200,V="touch-action",J=!1,$={events:["touchstart","touchmove","touchend","touchcancel"],register:function(e){J?w.listen(e,this.events):z.enableOnSubtree(e)},unregister:function(e){J&&w.unlisten(e,this.events)},elementAdded:function(e){var t=e.getAttribute(V),n=this.touchActionToScrollType(t);n&&(e._scrollType=n,w.listen(e,this.events),U(e).forEach(function(e){e._scrollType=n,w.listen(e,this.events)},this))},elementRemoved:function(e){e._scrollType=void 0,w.unlisten(e,this.events),U(e).forEach(function(e){e._scrollType=void 0,w.unlisten(e,this.events)},this)},elementChanged:function(e,t){var n=e.getAttribute(V),r=this.touchActionToScrollType(n),o=this.touchActionToScrollType(t);r&&o?(e._scrollType=r,U(e).forEach(function(e){e._scrollType=r},this)):o?this.elementRemoved(e):r&&this.elementAdded(e)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(e){var t=e,n=this.scrollTypes;return"none"===t?"none":t===n.XSCROLLER?"X":t===n.YSCROLLER?"Y":n.SCROLLER.exec(t)?"XY":void 0},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(e){return this.firstTouch===e.identifier},setPrimaryTouch:function(e){(0===K.size||1===K.size&&K.has(1))&&(this.firstTouch=e.identifier,this.firstXY={X:e.clientX,Y:e.clientY},this.scrolling=!1,this.cancelResetClickCount())},removePrimaryPointer:function(e){e.isPrimary&&(this.firstTouch=null,this.firstXY=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var e=function(){this.clickCount=0,this.resetId=null}.bind(this);this.resetId=setTimeout(e,G)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(e){var t=0;return("touchstart"===e||"touchmove"===e)&&(t=1),t},touchToPointer:function(e){var t=this.currentTouchEvent,n=w.cloneEvent(e),r=n.pointerId=e.identifier+2;n.target=j[r]||B(n),n.bubbles=!0,n.cancelable=!0,n.detail=this.clickCount,n.button=0,n.buttons=this.typeToButtons(t.type),n.width=e.radiusX||e.webkitRadiusX||0,n.height=e.radiusY||e.webkitRadiusY||0,n.pressure=e.force||e.webkitForce||.5,n.isPrimary=this.isPrimaryTouch(e),n.pointerType=this.POINTER_TYPE;var o=this;return n.preventDefault=function(){o.scrolling=!1,o.firstXY=null,t.preventDefault()},n},processTouches:function(e,t){var n=e.changedTouches;this.currentTouchEvent=e;for(var r,o=0;o<n.length;o++)r=n[o],t.call(this,this.touchToPointer(r))},shouldScroll:function(e){if(this.firstXY){var t,n=e.currentTarget._scrollType;if("none"===n)t=!1;else if("XY"===n)t=!0;else{var r=e.changedTouches[0],o=n,i="Y"===n?"X":"Y",a=Math.abs(r["client"+o]-this.firstXY[o]),s=Math.abs(r["client"+i]-this.firstXY[i]);t=a>=s}return this.firstXY=null,t}},findTouch:function(e,t){for(var n,r=0,o=e.length;o>r&&(n=e[r]);r++)if(n.identifier===t)return!0},vacuumTouches:function(e){var t=e.touches;if(K.size>=t.length){var n=[];K.forEach(function(e,r){if(1!==r&&!this.findTouch(t,r-2)){var o=e.out;n.push(o)}},this),n.forEach(this.cancelOut,this)}},touchstart:function(e){this.vacuumTouches(e),this.setPrimaryTouch(e.changedTouches[0]),this.dedupSynthMouse(e),this.scrolling||(this.clickCount++,this.processTouches(e,this.overDown))},overDown:function(e){K.set(e.pointerId,{target:e.target,out:e,outTarget:e.target}),w.over(e),w.enter(e),w.down(e)},touchmove:function(e){this.scrolling||(this.shouldScroll(e)?(this.scrolling=!0,this.touchcancel(e)):(e.preventDefault(),this.processTouches(e,this.moveOverOut)))},moveOverOut:function(e){var t=e,n=K.get(t.pointerId);if(n){var r=n.out,o=n.outTarget;w.move(t),r&&o!==t.target&&(r.relatedTarget=t.target,t.relatedTarget=o,r.target=o,t.target?(w.leaveOut(r),w.enterOver(t)):(t.target=o,t.relatedTarget=null,this.cancelOut(t))),n.out=t,n.outTarget=t.target}},touchend:function(e){this.dedupSynthMouse(e),this.processTouches(e,this.upOut)},upOut:function(e){this.scrolling||(w.up(e),w.out(e),w.leave(e)),this.cleanUpPointer(e)},touchcancel:function(e){this.processTouches(e,this.cancelOut)},cancelOut:function(e){w.cancel(e),w.out(e),w.leave(e),this.cleanUpPointer(e)},cleanUpPointer:function(e){K["delete"](e.pointerId),this.removePrimaryPointer(e)},dedupSynthMouse:function(e){var t=X.lastTouches,n=e.changedTouches[0];if(this.isPrimaryTouch(n)){var r={x:n.clientX,y:n.clientY};t.push(r);var o=function(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}.bind(null,t,r);setTimeout(o,W)}}};J||(z=new L($.elementAdded,$.elementRemoved,$.elementChanged,$));var Q,Z,ee=$,te=w.pointermap,ne=window.MSPointerEvent&&"number"==typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,re={events:["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerOut","MSPointerOver","MSPointerCancel","MSGotPointerCapture","MSLostPointerCapture"],register:function(e){w.listen(e,this.events)},unregister:function(e){w.unlisten(e,this.events)},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(e){var t=e;return ne&&(t=w.cloneEvent(e),t.pointerType=this.POINTER_TYPES[e.pointerType]),t},cleanup:function(e){te["delete"](e)},MSPointerDown:function(e){te.set(e.pointerId,e);var t=this.prepareEvent(e);w.down(t)},MSPointerMove:function(e){var t=this.prepareEvent(e);w.move(t)},MSPointerUp:function(e){var t=this.prepareEvent(e);w.up(t),this.cleanup(e.pointerId)},MSPointerOut:function(e){var t=this.prepareEvent(e);w.leaveOut(t)},MSPointerOver:function(e){var t=this.prepareEvent(e);w.enterOver(t)},MSPointerCancel:function(e){var t=this.prepareEvent(e);w.cancel(t),this.cleanup(e.pointerId)},MSLostPointerCapture:function(e){var t=w.makeEvent("lostpointercapture",e);w.dispatchEvent(t)},MSGotPointerCapture:function(e){var t=w.makeEvent("gotpointercapture",e);w.dispatchEvent(t)}},oe=re,ie=window.navigator;ie.msPointerEnabled?(Q=function(e){c(e),this.msSetPointerCapture(e)},Z=function(e){c(e),this.msReleasePointerCapture(e)}):(Q=function(e){c(e),w.setCapture(e,this)},Z=function(e){c(e),w.releaseCapture(e,this)}),a(),s(),u();var ae={dispatcher:w,Installer:L,PointerEvent:h,PointerMap:v,targetFinding:S};return ae})}]);